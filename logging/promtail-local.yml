server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  - job_name: maker-job-watcher-local
    static_configs:
      - targets:
          - localhost
        labels:
          job: maker-job-watcher-local
          service: maker-job-watcher
          environment: local
          format: json
          __path__: /var/log/maker-job-watcher/*.json
    pipeline_stages:
      - json:
          expressions:
            timestamp: timestamp
            level: level
            message: message
            service: service
            labels: labels
            context: context
      - timestamp:
          source: timestamp
          format: RFC3339
      - labels:
          level:
          service:
          environment:
          aws_region: labels.aws_region
          function_name: labels.function_name
          execution_id: labels.execution_id
          job_count: labels.job_count
          rpc_calls: labels.rpc_calls
      - output:
          source: message

  # Also capture any plain text logs
  - job_name: maker-job-watcher-text
    static_configs:
      - targets:
          - localhost
        labels:
          job: maker-job-watcher-text
          service: maker-job-watcher
          environment: local
          format: text
          __path__: /var/log/maker-job-watcher/*.log